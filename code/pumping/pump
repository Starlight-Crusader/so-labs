#!/bin/bash

# Check if the path to the binary file is provided as an argument
if [ $# -ne 1 ]; then
    echo "Usage: $0 <pa:th_to_binary_file>"
    exit 1
fi

# Path to the binary file passed as an argument
binary_file="$1"

# Check if the binary file exists
if [ ! -f "$binary_file" ]; then
    echo "Error: Binary file '$binary_file' does not exist."
    exit 1
fi

desired_size=1474560
# original_size=$(stat -c %s "$binary_file")
# bytes_to_pad=$(($desired_size - $original_size))

# Create an empty floppy disk image (1.44MB size)
floppy_image="floppy.img"
dd if=/dev/zero of="$floppy_image" bs=1 count=0 seek=$desired_size

# Write the binary file to the floppy image
dd if="$binary_file" of="$floppy_image" conv=notrunc

echo "Binary file '$binary_file' successfully added to floppy image '$floppy_image'."

# Verify that the size of the resulting image is exactly the desired size
actual_size=$(stat -c %s "$floppy_image")
if [ $actual_size -ne $desired_size ]; then
    echo "Error: The resulting image is not the desired size ($desired_size <> $actual_size bytes)."
    exit 1
fi
